(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{moveNode:()=>g,removeNode:()=>y,splitNode:()=>v});var n={};e.r(n),e.d(n,{addClass:()=>R,classesToArray:()=>E,getClass:()=>T,hasClass:()=>_,removeClass:()=>P,rnothtmlwhite:()=>O,stripAndCollapse:()=>w,toggleClass:()=>j});var r={};e.r(r),e.d(r,{findClosestAncestor:()=>k,findSelfOrAncestorWithClass:()=>A,isAncestorOf:()=>C,isOrIsAncestorOf:()=>x});var o={};e.r(o),e.d(o,{getIntersectionRange:()=>z,intersectsRange:()=>q});var i={};e.r(i),e.d(i,{RangeIterator:()=>$,iterateSubtree:()=>Y});var a={};e.r(a),e.d(a,{getEffectiveTextNodes:()=>G,getNodes:()=>U});var s={};function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==c(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===c(o)?o:String(o)),r)}var o}e.r(s),e.d(s,{getRangesInSelection:()=>Z,getSelection:()=>Q});var u=Function.prototype.apply,f=Function.prototype.call,h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__events__={}}var t,n;return t=e,n=[{key:"on",value:function(e,t){var n=this.__events__;return n[e]?"object"===c(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this}},{key:"once",value:function(e,t){var n,r;return(r=this).on.call(r,e,n=function(){r.off.call(r,e,n),u.call(t,r,arguments)}),n.__onceListener__=t,this}},{key:"off",value:function(e,t){var n=this.__events__;if(!n[e])return this;var r=n[e];if("object"===c(r))for(var o,i=0;o=r[i];++i)o!==t&&o.__onceListener__!==t||(2===r.length?n[e]=r[i?0:1]:r.splice(i,1));else r!==t&&r.__onceListener__!==t||delete n[e];return this}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o,i,a=this.__events__[e];if(a)if("object"===c(a)){for(o=arguments.length,n=new Array(o-1),i=1;i<o;++i)n[i-1]=arguments[i];a=a.slice();for(var s,l=0;s=a[l];++l)u.call(s,this,n)}else switch(arguments.length){case 1:f.call(a,this);break;case 2:f.call(a,this,arguments[1]);break;case 3:f.call(a,this,arguments[1],arguments[2]);break;default:for(o=arguments.length,n=new Array(o-1),i=1;i<o;++i)n[i-1]=arguments[i];u.call(a,this,n)}}}],n&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e){if(!e)return!1;var t=e.nodeType;return t===Node.TEXT_NODE||t===Node.COMMENT_NODE}function p(e){for(var t=0;e=e.previousSibling;)t++;return t}function v(e,t,n){var r,o,i,a=0===n;if(d(t)){var s=p(t);0===n?n=s:n===t.data.length&&(n=s+1),t=t.parentNode}if(i=n,d(o=t)?0===i?o.previousSibling:i!==o.length||o.nextSibling:i>0&&i<o.childNodes.length){(r=t.cloneNode(!1)).hasAttribute("id")&&r.removeAttribute("id");for(var c,l=0;c=t.childNodes[n];)g(c,r,l++);g(r,t.parentNode,p(t)+1)}else if(e!==t){r=t.parentNode;var u=p(t);return a||u++,v(e,r,u)}}function y(e){var t=e.parentNode;return t?t.removeChild(e):null}function g(e,t,n){-1===n&&(n=t.childNodes.length),n===t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function m(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N=!(void 0!==document.createElement("span").classList),S=!(void 0!==document.createElement("span").className),O=/[^\x20\t\r\n\f]+/g;function w(e){return(e.match(O)||[]).join(" ")}function E(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(O)||[]}function j(e,t){var n=E(t);return!(!n.length||e.nodeType!==Node.ELEMENT_NODE||(n.forEach((function(t){N?e.classList.toggle(t):_(e,t)?P(e,t):R(e,t)})),0))}function T(e){return e.nodeType!==Node.ELEMENT_NODE?"":S?e.className:e.getAttribute("class")||""}function _(e,t){return e.nodeType===Node.ELEMENT_NODE&&(N?e.classList.contains(t):E(T(e)).indexOf(t)>-1)}function R(e,t){var n,r,o,i,a=E(t);a.length&&e.nodeType===Node.ELEMENT_NODE&&(N?(i=e.classList).add.apply(i,m(a)):(n=T(e),r=" "+w(n)+" ",a.forEach((function(e){r.indexOf(" "+e+" ")<0&&(r+=e+" ")})),n!==(o=w(r))&&(S?e.className=o:e.setAttribute("class",o))))}function P(e,t){var n,r,o,i,a=E(t),s=e.nodeType===Node.ELEMENT_NODE;if(arguments.length<2&&s)return e.removeAttribute("class");a.length&&s&&(N?(i=e.classList).remove.apply(i,m(a)):(n=T(e),r=" "+w(n)+" ",a.forEach((function(e){for(;r.indexOf(" "+e+" ")>-1;)r=r.replace(" "+e+" "," ")})),n!==(o=w(r))&&(S?e.className=o:e.setAttribute("class",o))))}function k(e,t){for(var n;t;){if((n=t.parentNode)===e)return t;t=n}return null}function C(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function x(e,t){return C(e,t,!0)}function A(e,t){for(;e;){if(_(e,t))return e;e=e.parentNode}return null}function D(e){return e.nodeType===Node.ELEMENT_NODE?e.childNodes.length:d(e)?e.length:0}function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==I(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===I(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const H=L(L(L(L({},t),n),r),{},{isCharacterDataNode:d,getNodeIndex:p,getNodeLength:D,getSelection});function B(e){var t,n,r=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2],i=D(r);switch(arguments.length<=1?0:arguments.length-1){case 2:t=r,n=i;break;case 3:t=arguments.length<=3?void 0:arguments[3],n=o;break;case 4:t=arguments.length<=3?void 0:arguments[3],n=arguments.length<=4?void 0:arguments[4]}e.setStart(r,o),e.setEnd(t,n)}function z(e,t){if(q(e,t)){var n=e.cloneRange();return-1===n.compareBoundaryPoints(t.START_TO_START,t)&&n.setStart(t.startContainer,t.startOffset),1===n.compareBoundaryPoints(t.END_TO_END,t)&&n.setEnd(t.endContainer,t.endOffset),n}return null}function q(e,t){var n=e.compareBoundaryPoints(t.END_TO_START,t),r=e.compareBoundaryPoints(t.START_TO_END,t);return n<0&&r>0}function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,J(r.key),r)}}function V(e,t,n){return(t=J(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e){var t=function(e,t){if("object"!==X(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==X(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===X(t)?t:String(t)}var $=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),V(this,"_current",null),V(this,"_end",null),V(this,"_next",null),this.range=t,this.clonePartiallySelectedTextNodes=n,this.range.collapsed||(this.root=this.range.commonAncestorContainer,this.sc=this.range.startContainer,this.so=this.range.startOffset,this.ec=this.range.endContainer,this.eo=this.range.endOffset,this.sc===this.ec&&d(this.sc)?this._next=this._end=this.sc:(this._next=this.sc!==this.root||d(this.sc)?k(this.root,this.sc):this.sc.childNodes[this.so],this._end=this.ec!==this.root||d(this.ec)?k(this.root,this.ec):this.ec.childNodes[this.eo-1]))}var t,n;return t=e,(n=[{key:"next",value:function(){var e=this._current=this._next;return this._next=null!=this._current&&this._current!==this._end?this._current.nextSibling:null,d(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),e===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so)),e}},{key:"isPartiallySelectedSubtree",value:function(){return!d(this._current)&&(x(this._current,this.sc)||x(this._current,this.ec))}},{key:"getSubtreeIterator",value:function(){var t=document.createRange(),n=this._current,r=n,o=0,i=n,a=D(n);return n&&(x(n,this.sc)&&(r=this.sc,o=this.so),x(n,this.ec)&&(i=this.ec,a=this.eo)),B(t,r,o,i,a),new e(t,this.clonePartiallySelectedTextNodes)}}])&&F(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Y(e,t){for(var n;n=e.next();)if(e.isPartiallySelectedSubtree())Y(e.getSubtreeIterator(),t);else for(var r=document.createNodeIterator(n);n=r.nextNode();)t(n)}function U(e,t,n){var r,o=[];return t&&t.length&&(r=new RegExp("(".concat(t.join("|"),")$"))),Y(new $(e,!1),(function(e){r&&!r.test(e.nodeType.toString())||("function"!=typeof n||n(e))&&o.push(e)})),o}function G(e){for(var t,n=U(e,[Node.TEXT_NODE]),r=0,o=n.length;(t=n[r])&&!K(e,t);)++r;for(;(t=n[o-1])&&!K(e,t);)--o;return n.slice(r,o)}function K(e,t){var n=document.createRange();n.selectNodeContents(t);var r=z(n,e);return""!==(r?r.toString():"")}function Q(e){return e instanceof Selection?e:window.getSelection()}function Z(e){for(var t=[],n=0;n<e.rangeCount;++n)t.push(e.getRangeAt(n));return t}function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==ee(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ee(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===ee(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const oe=ne(ne(ne(ne(ne({},o),a),i),s),{},{splitRangeBoundaries:function(e){var t=[e.startContainer,e.startOffset,e.endContainer,e.endOffset],n=t[0],r=t[1],o=t[2],i=t[3],a=n===o;d(o)&&i>0&&i<o.length&&o.splitText(i),d(n)&&r>0&&r<n.length&&(n=n.splitText(r),a?(i-=r,o=n):o===n.parentNode&&i<=p(n)&&i++,r=0)},setRange:B});function ie(e,t){for(var n in e)if(!1===t.call(e[n],n,e[n]))break;return e}function ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={tagName:"span",className:"highlight",elAttrs:{},elProps:{},normalize:!0};return ie(e,(function(n,r){e.hasOwnProperty(n)&&(t[n]=r)})),t}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==se(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===se(o)?o:String(o)),r)}var o}function ue(e,t,n){return t&&le(e.prototype,t),n&&le(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var fe=function(){function e(t){ce(this,e),this.options=ae(t)}return ue(e,[{key:"appliesToRange",value:function(e){var t=this;oe.splitRangeBoundaries(e);var n=oe.getEffectiveTextNodes(e);if(n.length){n.forEach((function(e){t.options.className&&!H.findSelfOrAncestorWithClass(e,t.options.className)&&t.appliesToTextNode(e)}));var r=n[n.length-1];oe.setRange(e,n[0],0,r,r.length),this.options.normalize&&this.normalize(n,e,!1)}}},{key:"appliesToTextNode",value:function(e){var t=e.parentNode;if(e.nodeType===Node.TEXT_NODE&&t){var n=this.createElement();n&&(t.insertBefore(n,e),n.appendChild(e))}}},{key:"wipeToRange",value:function(e){var t=this;oe.splitRangeBoundaries(e);var n=oe.getEffectiveTextNodes(e);if(n.length){!function(e,t){[{node:e.endContainer,offset:e.endOffset},{node:e.startContainer,offset:e.startOffset}].forEach((function(e){var n=e.node,r=e.offset,o=H.findSelfOrAncestorWithClass(n,t);o&&H.splitNode(o,n,r)}))}(e,this.options.className),n.forEach((function(e){var n=H.findSelfOrAncestorWithClass(e,t.options.className);n&&t.wipeToAncestor(n)}));var r=n[n.length-1];oe.setRange(e,n[0],0,r,r.length),this.options.normalize&&this.normalize(n,e,!0)}}},{key:"wipeToAncestor",value:function(e){if(this.isEqualNode(e)){for(var t,n=H.getNodeIndex(e),r=e.parentNode;t=e.firstChild;)H.moveNode(t,r,n++);H.removeNode(e)}else H.removeClass(e,this.options.className)}},{key:"createElement",value:function(){if(this.options.tagName){var e=document.createElement(this.options.tagName);return this.options.className&&this.options.elAttrs&&this.options.elProps&&(H.addClass(e,this.options.className),function(e,t){ie(t,(function(n,r){t.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&e.setAttribute(n,r)}))}(e,this.options.elAttrs),function(e,t){ie(t,(function(n,r){t.hasOwnProperty(n)&&("className"===n?H.addClass(e,r):e[n]=r)}))}(e,this.options.elProps)),e}return null}},{key:"normalize",value:function(e,t,n){var r=this,o=e[0],i=e[e.length-1],a=null,s=[],c=o,l=i,u=0,f=i.length;e.forEach((function(e){var t=he(e,!n,(function(e){return r.isEqualNode(e)}));t?(null==a&&(a=new ve(t),s.push(a)),a.textNodes.push(e),c===e&&(c=a.textNodes[0],u=c.length),l===e&&(l=a.textNodes[0],f=a.getLength())):a=null}));var h=de(i,!n,(function(e){return r.isEqualNode(e)}));h&&(null==a&&(a=new ve(i),s.push(a)),a.textNodes.push(h)),s.length&&(s.forEach((function(e){return e.start()})),oe.setRange(t,c,u,l,f))}},{key:"isEqualNode",value:function(e){var t=this.createElement();return!!t&&t.cloneNode(!1).isEqualNode(e.cloneNode(!1))}}]),e}(),he=pe(!1),de=pe(!0);function pe(e){var t=e?"nextSibling":"previousSibling",n=e?"firstChild":"lastChild";return function(e,r,o){var i=e[t],a=e.parentNode;if(i&&i.nodeType===Node.TEXT_NODE)return i;if(r&&(i=a[t])&&i.nodeType===Node.ELEMENT_NODE){if(o&&!o(i))return null;var s=i[n];if(s&&s.nodeType===Node.TEXT_NODE)return s}return null}}var ve=function(){function e(t){ce(this,e);var n=t.nodeType===Node.ELEMENT_NODE?t.firstChild:t;n&&(this.firstTextNode=n,this.textNodes=[n])}return ue(e,[{key:"start",value:function(){var e=[];return this.textNodes.forEach((function(t,n){var r=t.parentNode;n>0&&r&&(H.removeNode(t),r.hasChildNodes()||H.removeNode(r)),e.push(t.data)})),this.firstTextNode.data=e.join(""),this.firstTextNode.data}},{key:"getLength",value:function(){var e=0;return this.textNodes.forEach((function(t){e+=t.length})),e}}]),e}();function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ye(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===ye(o)?o:String(o)),r)}var o}var me=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=t,this.end=n,this.referenceNode=r,this.isCollapsed=this.start===this.end}var t,n,r;return t=e,r=[{key:"fromRange",value:function(t,n){var r=t.cloneRange();r.selectNodeContents(n);var o=oe.getIntersectionRange(r,t),i=0,a=0;return o&&(r.setEnd(o.startContainer,o.startOffset),a=(i=r.toString().length)+o.toString().length),new e(i,a,n)}},{key:"fromSelection",value:function(t,n){var r=[];return oe.getRangesInSelection(t).forEach((function(t){r.push(e.fromRange(t,n))})),r}}],(n=[{key:"_createRelativeCharacterRange",value:function(t){return t.referenceNode!==this.referenceNode?e.fromRange(t.toRange(),this.referenceNode):t}},{key:"isEqual",value:function(e){return e=this._createRelativeCharacterRange(e),this.start===e.start&&this.end===e.end}},{key:"isIntersects",value:function(e){return e=this._createRelativeCharacterRange(e),this.start<e.end&&this.end>e.start}},{key:"isAdjoin",value:function(e){return e=this._createRelativeCharacterRange(e),this.start===e.end||this.end===e.start}},{key:"union",value:function(t){return t=this._createRelativeCharacterRange(t),this.isIntersects(t)||this.isAdjoin(t)?new e(Math.min(this.start,t.start),Math.max(this.end,t.end),this.referenceNode):null}},{key:"intersection",value:function(t){return t=this._createRelativeCharacterRange(t),this.isIntersects(t)?new e(Math.max(this.start,t.start),Math.min(this.end,t.end),this.referenceNode):null}},{key:"complementarySet",value:function(t){var n=[];return t=this._createRelativeCharacterRange(t),this.start<t.start&&n.push(new e(this.start,t.start,this.referenceNode)),this.end>t.end&&n.push(new e(t.end,this.end,this.referenceNode)),n}},{key:"toRange",value:function(){var e=document.createRange(),t=this.start,n=this.end;e.setStart(this.referenceNode,0),e.collapse(!0);for(var r,o,i=document.createNodeIterator(this.referenceNode,NodeFilter.SHOW_TEXT),a=0,s=!1,c=!1;!c&&(r=i.nextNode())&&r;)o=a+r.length,!s&&t>=a&&t<=o&&(e.setStart(r,t-a),s=!0),n>=a&&n<=o&&(e.setEnd(r,n-a),c=!0),a=o;return e}}])&&ge(t.prototype,n),r&&ge(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function be(e){return"hidden"!==e&&"visible"!==e&&"clip"!==e}function Ne(e){if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){var t=getComputedStyle(e);return be(t.overflowY)||be(t.overflowX)||function(e){var t=function(e){if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}}(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)}(e)}return!1}function Se(e,t,n,r,o,i,a,s){return i<e&&a>t||i>e&&a<t?0:i<=e&&s<=n||a>=t&&s>=n?i-e-r:a>t&&s<n||i<e&&s>n?a-t+o:0}function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ee(r.key),r)}}function Ee(e){var t=function(e,t){if("object"!==Oe(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Oe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Oe(t)?t:String(t)}var je,Te,_e=function(){function e(t,n){var r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,(o=Ee(o="applied"))in r?Object.defineProperty(r,o,{value:false,enumerable:!0,configurable:!0,writable:!0}):r[o]=false,this.characterRange=t,this.refills=n}var t,n;return t=e,(n=[{key:"on",value:function(){this.range=this.characterRange.toRange(),this.refills.appliesToRange(this.range),this.applied=!0}},{key:"off",value:function(){this.range=this.characterRange.toRange(),this.refills.wipeToRange(this.range),this.applied=!1}},{key:"intersectsNode",value:function(e){var t=document.createRange();return t.selectNodeContents(e),oe.intersectsRange(this.characterRange.toRange(),t)}},{key:"scrollIntoView",value:function(e){var t="boolean"==typeof e||null==e?void 0:e.behavior;(function(e,t){for(var n,r,o,i,a=t.block,s=t.inline,c=t.scrollMode,l=document.scrollingElement||document.documentElement,u=[],f=(h=e.commonAncestorContainer)&&h.nodeType===Node.ELEMENT_NODE?h:null;f;){if(f===l){u.push(f);break}f===document.body&&Ne(f)&&!Ne(document.documentElement)||(null!=f&&Ne(f)&&u.push(f),f=f.parentElement)}var h,d=null!==(n=null===(r=window.visualViewport)||void 0===r?void 0:r.width)&&void 0!==n?n:window.innerWidth,p=null!==(o=null===(i=window.visualViewport)||void 0===i?void 0:i.height)&&void 0!==o?o:window.innerHeight,v=window,y=v.scrollX,g=v.scrollY,m=e.getBoundingClientRect(),b=m.height,N=m.width,S=m.top,O=m.right,w=m.bottom,E=m.left,j="start"===a||"nearest"===a?S:"end"===a?w:S+b/2,T="center"===s?E+N/2:"end"===s?O:E,_=[];return u.forEach((function(e){var t=e.getBoundingClientRect(),n=t.height,r=t.width,o=t.top,i=t.right,u=t.bottom,f=t.left;if("if-needed"===c&&S>=0&&E>=0&&w<=p&&O<=d&&S>=o&&w<=u&&E>=f&&O<=i)return _;var h=getComputedStyle(e),v=parseInt(h.borderLeftWidth,10),m=parseInt(h.borderTopWidth,10),R=parseInt(h.borderRightWidth,10),P=parseInt(h.borderBottomWidth,10),k=0,C=0,x="offsetWidth"in e?e.offsetWidth-e.clientWidth-v-R:0,A="offsetHeight"in e?e.offsetHeight-e.clientHeight-m-P:0,D="offsetWidth"in e?0===e.offsetWidth?0:r/e.offsetWidth:0,I="offsetHeight"in e?0===e.offsetHeight?0:n/e.offsetHeight:0;if(l===e)k="start"===a?j:"end"===a?j-p:"nearest"===a?Se(g,g+p,p,m,P,g+j,g+j+b,b):j-p/2,C="start"===s?T:"center"===s?T-d/2:"end"===s?T-d:Se(y,y+d,d,v,R,y+T,y+T+N,N),k=Math.max(0,k+g),C=Math.max(0,C+y);else{k="start"===a?j-o-m:"end"===a?j-u+P+A:"nearest"===a?Se(o,u,n,m,P+A,j,j+b,b):j-(o+n/2)+A/2,C="start"===s?T-f-v:"center"===s?T-(f+r/2)+x/2:"end"===s?T-i+R+x:Se(f,i,r,v,R+x,T,T+N,N);var M=e.scrollLeft,L=e.scrollTop;k=Math.max(0,Math.min(L+k/I,e.scrollHeight-n/I+A)),C=Math.max(0,Math.min(M+C/D,e.scrollWidth-r/D+x)),j+=L-k,T+=M-C}_.push({el:e,top:k,left:C})})),_})(this.characterRange.toRange(),function(e){return!1===e?{block:"end",inline:"nearest"}:e===Object(e)&&0!==Object.keys(e).length?e:{block:"start",inline:"nearest"}}(e)).forEach((function(e){var n=e.el,r=e.top,o=e.left;n.scrollTo({top:r,left:o,behavior:t})}))}},{key:"getText",value:function(){return this.toRange().toString()}},{key:"toRange",value:function(){return this.characterRange.toRange()}}])&&we(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Re(e){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Re(e)}function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(n),!0).forEach((function(t){Ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Me(r.key),r)}}function xe(e,t){return xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xe(e,t)}function Ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e){return De=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},De(e)}function Ie(e,t,n){return(t=Me(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e){var t=function(e,t){if("object"!==Re(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==Re(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Re(t)?t:String(t)}function Le(e){return document.getElementById(e)||document.body}function We(e,t){e.removeAllRanges(),t.forEach((function(t){t.isCollapsed||e.addRange(t.toRange())}))}var He,Be="highlights",ze=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xe(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=De(r);if(o){var n=De(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Re(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ae(e)}(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Ie(Ae(t=i.call(this)),"highlights",[]),t.options=t.setOptions(e),t}return t=a,n=[{key:"setOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e=ae(e)).elProps=ke(ke({},e.elProps),{},{onclick:this._handleHighlightClick.bind(this)}),this.refills=new fe(e),e}},{key:"_handleHighlightClick",value:function(e){var t=e.target,n=this.getHighlightForElement(t);this.emit("click",n,t,e)}},{key:"getHighlightForElement",value:function(e){for(var t,n=0;t=this.highlights[n++];)if(t.intersectsNode(e))return t;return null}},{key:"useSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[],n=oe.getSelection(e.selection),r=Le(e.referenceNodeId);if(r){var o=me.fromSelection(n,r);t=this._useCharacterRanges(o),We(n,o)}return t}},{key:"_useCharacterRanges",value:function(e){for(var t,n=this,r=[],o=function(e){if(e.isCollapsed)return t=e,"continue";for(var o,i=!1,a=0;o=n.highlights[a];++a)e.isEqual(o.characterRange)?i=!0:(e.isIntersects(o.characterRange)||e.isAdjoin(o.characterRange))&&(e=e.union(o.characterRange),r.push(o),n.highlights.splice(a--,1));!i&&e&&n.highlights.push(new _e(e,n.refills)),r.forEach((function(e){e.applied&&e.off()}));var s=[];return n.highlights.forEach((function(e){e.applied||(e.on(),s.push(e))})),{v:s}},i=0;t=e[i++];){var a=o(t);if("continue"!==a&&"object"===Re(a))return a.v}}},{key:"unSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[],n=oe.getSelection(e.selection),r=Le(e.referenceNodeId);if(r){var o=me.fromSelection(n,r);t=this._unCharacterRanges(o),We(n,o)}return t}},{key:"_unCharacterRanges",value:function(e){for(var t,n=this,r=[],o=0;t=e[o++];)if(!t.isCollapsed)for(var i,a=0;i=this.highlights[a];++a)if(t.isIntersects(i.characterRange)){var s=t.intersection(i.characterRange);s&&(i.characterRange.complementarySet(s).forEach((function(e){n.highlights.push(new _e(e,n.refills))})),r.push(i),this.highlights.splice(a--,1))}var c=[];return r.forEach((function(e){e.applied&&(e.off(),c.push(e))})),this.highlights.forEach((function(e){e.applied||e.on()})),c}},{key:"removeHighlight",value:function(e){if(e instanceof _e){var t,n=this.highlights;(t=n.indexOf(e))>-1&&(e.applied&&e.off(),n.splice(t,1))}}},{key:"serialize",value:function(){var e=this;return this.highlights.map((function(t){return{start:t.characterRange.start,end:t.characterRange.end,referenceNodeId:t.characterRange.referenceNode.id,className:e.options.className,text:t.getText()}}))}},{key:"deserialize",value:function(e){var t=this,n=[];e.forEach((function(e){var r=e.start,o=e.end,i=Le(e.referenceNodeId);if(i){var a=new _e(new me(r,o,i),t.refills);a.on(),n.push(a)}})),this.highlights=n}}],n&&Ce(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(h));function qe(e,t){document.cookie="".concat(e,"=").concat(t)}He=Be,document.cookie.split(";").some((function(e){return e.trim().startsWith("".concat(He,"="))}))&&ze.deserialize(JSON.parse(function(e){var t;return null===(t=document.cookie.split("; ").find((function(t){return t.startsWith("".concat(e,"="))})))||void 0===t?void 0:t.split("=")[1]}(Be))),null===(je=document.querySelector(".main"))||void 0===je||je.addEventListener("mouseup",(function(){var e=window.getSelection().getRangeAt(0);""===e.toString()||e.collapsed||ze.useSelection({selection:window.getSelection().getRangeAt(0),referenceNodeId:"main"})})),null===(Te=document.getElementById("submit"))||void 0===Te||Te.addEventListener("click",(function(){var e=JSON.stringify(ze.serialize());qe(Be,e),window.location.reload()})),ze.on("click",(function(e){if(window.confirm("remove highlight ??")){ze.removeHighlight(e);var t=JSON.stringify(ze.serialize());qe(Be,t)}}))})();
//# sourceMappingURL=serialize.js.map