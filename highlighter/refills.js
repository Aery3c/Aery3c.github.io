(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{moveNode:()=>d,removeNode:()=>f,splitNode:()=>u});var n={};e.r(n),e.d(n,{addClass:()=>S,classesToArray:()=>b,getClass:()=>E,hasClass:()=>O,removeClass:()=>T,rnothtmlwhite:()=>g,stripAndCollapse:()=>m,toggleClass:()=>N});var r={};e.r(r),e.d(r,{findClosestAncestor:()=>w,findSelfOrAncestorWithClass:()=>_,isAncestorOf:()=>P,isOrIsAncestorOf:()=>j});var o={};e.r(o),e.d(o,{getIntersectionRange:()=>I,intersectsRange:()=>M});var i={};e.r(i),e.d(i,{RangeIterator:()=>W,iterateSubtree:()=>$});var a={};e.r(a),e.d(a,{getEffectiveTextNodes:()=>U,getNodes:()=>F});var s={};function l(e){if(!e)return!1;var t=e.nodeType;return t===Node.TEXT_NODE||t===Node.COMMENT_NODE}function c(e){for(var t=0;e=e.previousSibling;)t++;return t}function u(e,t,n){var r,o,i,a=0===n;if(l(t)){var s=c(t);0===n?n=s:n===t.data.length&&(n=s+1),t=t.parentNode}if(i=n,l(o=t)?0===i?o.previousSibling:i!==o.length||o.nextSibling:i>0&&i<o.childNodes.length){(r=t.cloneNode(!1)).hasAttribute("id")&&r.removeAttribute("id");for(var f,p=0;f=t.childNodes[n];)d(f,r,p++);d(r,t.parentNode,c(t)+1)}else if(e!==t){r=t.parentNode;var h=c(t);return a||h++,u(e,r,h)}}function f(e){var t=e.parentNode;return t?t.removeChild(e):null}function d(e,t,n){-1===n&&(n=t.childNodes.length),n===t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function p(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.r(s),e.d(s,{getRangesInSelection:()=>J,getSelection:()=>H});var y=!(void 0!==document.createElement("span").classList),v=!(void 0!==document.createElement("span").className),g=/[^\x20\t\r\n\f]+/g;function m(e){return(e.match(g)||[]).join(" ")}function b(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(g)||[]}function N(e,t){var n=b(t);return!(!n.length||e.nodeType!==Node.ELEMENT_NODE||(n.forEach((function(t){y?e.classList.toggle(t):O(e,t)?T(e,t):S(e,t)})),0))}function E(e){return e.nodeType!==Node.ELEMENT_NODE?"":v?e.className:e.getAttribute("class")||""}function O(e,t){return e.nodeType===Node.ELEMENT_NODE&&(y?e.classList.contains(t):b(E(e)).indexOf(t)>-1)}function S(e,t){var n,r,o,i,a=b(t);a.length&&e.nodeType===Node.ELEMENT_NODE&&(y?(i=e.classList).add.apply(i,p(a)):(n=E(e),r=" "+m(n)+" ",a.forEach((function(e){r.indexOf(" "+e+" ")<0&&(r+=e+" ")})),n!==(o=m(r))&&(v?e.className=o:e.setAttribute("class",o))))}function T(e,t){var n,r,o,i,a=b(t),s=e.nodeType===Node.ELEMENT_NODE;if(arguments.length<2&&s)return e.removeAttribute("class");a.length&&s&&(y?(i=e.classList).remove.apply(i,p(a)):(n=E(e),r=" "+m(n)+" ",a.forEach((function(e){for(;r.indexOf(" "+e+" ")>-1;)r=r.replace(" "+e+" "," ")})),n!==(o=m(r))&&(v?e.className=o:e.setAttribute("class",o))))}function w(e,t){for(var n;t;){if((n=t.parentNode)===e)return t;t=n}return null}function P(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function j(e,t){return P(e,t,!0)}function _(e,t){for(;e;){if(O(e,t))return e;e=e.parentNode}return null}function x(e){return e.nodeType===Node.ELEMENT_NODE?e.childNodes.length:l(e)?e.length:0}function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==A(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===A(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const k=D(D(D(D({},t),n),r),{},{isCharacterDataNode:l,getNodeIndex:c,getNodeLength:x,getSelection});function L(e){var t,n,r=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2],i=x(r);switch(arguments.length<=1?0:arguments.length-1){case 2:t=r,n=i;break;case 3:t=arguments.length<=3?void 0:arguments[3],n=o;break;case 4:t=arguments.length<=3?void 0:arguments[3],n=arguments.length<=4?void 0:arguments[4]}e.setStart(r,o),e.setEnd(t,n)}function I(e,t){if(M(e,t)){var n=e.cloneRange();return-1===n.compareBoundaryPoints(t.START_TO_START,t)&&n.setStart(t.startContainer,t.startOffset),1===n.compareBoundaryPoints(t.END_TO_END,t)&&n.setEnd(t.endContainer,t.endOffset),n}return null}function M(e,t){var n=e.compareBoundaryPoints(t.END_TO_START,t),r=e.compareBoundaryPoints(t.START_TO_END,t);return n<0&&r>0}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,X(r.key),r)}}function q(e,t,n){return(t=X(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e){var t=function(e,t){if("object"!==B(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==B(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===B(t)?t:String(t)}var W=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),q(this,"_current",null),q(this,"_end",null),q(this,"_next",null),this.range=t,this.clonePartiallySelectedTextNodes=n,this.range.collapsed||(this.root=this.range.commonAncestorContainer,this.sc=this.range.startContainer,this.so=this.range.startOffset,this.ec=this.range.endContainer,this.eo=this.range.endOffset,this.sc===this.ec&&l(this.sc)?this._next=this._end=this.sc:(this._next=this.sc!==this.root||l(this.sc)?w(this.root,this.sc):this.sc.childNodes[this.so],this._end=this.ec!==this.root||l(this.ec)?w(this.root,this.ec):this.ec.childNodes[this.eo-1]))}var t,n;return t=e,(n=[{key:"next",value:function(){var e=this._current=this._next;return this._next=null!=this._current&&this._current!==this._end?this._current.nextSibling:null,l(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),e===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so)),e}},{key:"isPartiallySelectedSubtree",value:function(){return!l(this._current)&&(j(this._current,this.sc)||j(this._current,this.ec))}},{key:"getSubtreeIterator",value:function(){var t=document.createRange(),n=this._current,r=n,o=0,i=n,a=x(n);return n&&(j(n,this.sc)&&(r=this.sc,o=this.so),j(n,this.ec)&&(i=this.ec,a=this.eo)),L(t,r,o,i,a),new e(t,this.clonePartiallySelectedTextNodes)}}])&&z(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $(e,t){for(var n;n=e.next();)if(e.isPartiallySelectedSubtree())$(e.getSubtreeIterator(),t);else for(var r=document.createNodeIterator(n);n=r.nextNode();)t(n)}function F(e,t,n){var r,o=[];return t&&t.length&&(r=new RegExp("(".concat(t.join("|"),")$"))),$(new W(e,!1),(function(e){r&&!r.test(e.nodeType.toString())||("function"!=typeof n||n(e))&&o.push(e)})),o}function U(e){for(var t,n=F(e,[Node.TEXT_NODE]),r=0,o=n.length;(t=n[r])&&!G(e,t);)++r;for(;(t=n[o-1])&&!G(e,t);)--o;return n.slice(r,o)}function G(e,t){var n=document.createRange();n.selectNodeContents(t);var r=I(n,e);return""!==(r?r.toString():"")}function H(e){return e instanceof Selection?e:window.getSelection()}function J(e){for(var t=[],n=0;n<e.rangeCount;++n)t.push(e.getRangeAt(n));return t}function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==K(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==K(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===K(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Z=V(V(V(V(V({},o),a),i),s),{},{splitRangeBoundaries:function(e){var t=[e.startContainer,e.startOffset,e.endContainer,e.endOffset],n=t[0],r=t[1],o=t[2],i=t[3],a=n===o;l(o)&&i>0&&i<o.length&&o.splitText(i),l(n)&&r>0&&r<n.length&&(n=n.splitText(r),a?(i-=r,o=n):o===n.parentNode&&i<=c(n)&&i++,r=0)},setRange:L});function ee(e,t){for(var n in e)if(!1===t.call(e[n],n,e[n]))break;return e}function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==te(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==te(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===te(o)?o:String(o)),r)}var o}function oe(e,t,n){return t&&re(e.prototype,t),n&&re(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var ie=function(){function e(t){ne(this,e),this.options=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={tagName:"span",className:"highlight",elAttrs:{},elProps:{},normalize:!0};return ee(e,(function(n,r){e.hasOwnProperty(n)&&(t[n]=r)})),t}(t)}return oe(e,[{key:"appliesToRange",value:function(e){var t=this;Z.splitRangeBoundaries(e);var n=Z.getEffectiveTextNodes(e);if(n.length){n.forEach((function(e){t.options.className&&!k.findSelfOrAncestorWithClass(e,t.options.className)&&t.appliesToTextNode(e)}));var r=n[n.length-1];Z.setRange(e,n[0],0,r,r.length),this.options.normalize&&this.normalize(n,e,!1)}}},{key:"appliesToTextNode",value:function(e){var t=e.parentNode;if(e.nodeType===Node.TEXT_NODE&&t){var n=this.createElement();n&&(t.insertBefore(n,e),n.appendChild(e))}}},{key:"wipeToRange",value:function(e){var t=this;Z.splitRangeBoundaries(e);var n=Z.getEffectiveTextNodes(e);if(n.length){!function(e,t){[{node:e.endContainer,offset:e.endOffset},{node:e.startContainer,offset:e.startOffset}].forEach((function(e){var n=e.node,r=e.offset,o=k.findSelfOrAncestorWithClass(n,t);o&&k.splitNode(o,n,r)}))}(e,this.options.className),n.forEach((function(e){var n=k.findSelfOrAncestorWithClass(e,t.options.className);n&&t.wipeToAncestor(n)}));var r=n[n.length-1];Z.setRange(e,n[0],0,r,r.length),this.options.normalize&&this.normalize(n,e,!0)}}},{key:"wipeToAncestor",value:function(e){if(this.isEqualNode(e)){for(var t,n=k.getNodeIndex(e),r=e.parentNode;t=e.firstChild;)k.moveNode(t,r,n++);k.removeNode(e)}else k.removeClass(e,this.options.className)}},{key:"createElement",value:function(){if(this.options.tagName){var e=document.createElement(this.options.tagName);return this.options.className&&this.options.elAttrs&&this.options.elProps&&(k.addClass(e,this.options.className),function(e,t){ee(t,(function(n,r){t.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&e.setAttribute(n,r)}))}(e,this.options.elAttrs),function(e,t){ee(t,(function(n,r){t.hasOwnProperty(n)&&("className"===n?k.addClass(e,r):e[n]=r)}))}(e,this.options.elProps)),e}return null}},{key:"normalize",value:function(e,t,n){var r=this,o=e[0],i=e[e.length-1],a=null,s=[],l=o,c=i,u=0,f=i.length;e.forEach((function(e){var t=ae(e,!n,(function(e){return r.isEqualNode(e)}));t?(null==a&&(a=new fe(t),s.push(a)),a.textNodes.push(e),l===e&&(l=a.textNodes[0],u=l.length),c===e&&(c=a.textNodes[0],f=a.getLength())):a=null}));var d=se(i,!n,(function(e){return r.isEqualNode(e)}));d&&(null==a&&(a=new fe(i),s.push(a)),a.textNodes.push(d)),s.length&&(s.forEach((function(e){return e.start()})),Z.setRange(t,l,u,c,f))}},{key:"isEqualNode",value:function(e){var t=this.createElement();return!!t&&t.cloneNode(!1).isEqualNode(e.cloneNode(!1))}}]),e}(),ae=le(!1),se=le(!0);function le(e){var t=e?"nextSibling":"previousSibling",n=e?"firstChild":"lastChild";return function(e,r,o){var i=e[t],a=e.parentNode;if(i&&i.nodeType===Node.TEXT_NODE)return i;if(r&&(i=a[t])&&i.nodeType===Node.ELEMENT_NODE){if(o&&!o(i))return null;var s=i[n];if(s&&s.nodeType===Node.TEXT_NODE)return s}return null}}var ce,ue,fe=function(){function e(t){ne(this,e);var n=t.nodeType===Node.ELEMENT_NODE?t.firstChild:t;n&&(this.firstTextNode=n,this.textNodes=[n])}return oe(e,[{key:"start",value:function(){var e=[];return this.textNodes.forEach((function(t,n){var r=t.parentNode;n>0&&r&&(k.removeNode(t),r.hasChildNodes()||k.removeNode(r)),e.push(t.data)})),this.firstTextNode.data=e.join(""),this.firstTextNode.data}},{key:"getLength",value:function(){var e=0;return this.textNodes.forEach((function(t){e+=t.length})),e}}]),e}();Function.prototype.apply,Function.prototype.call;var de=new ie({tagName:"span"});null===(ce=document.getElementById("appliesToRange"))||void 0===ce||ce.addEventListener("click",(function(){de.appliesToRange(window.getSelection().getRangeAt(0))})),null===(ue=document.getElementById("wipeToRange"))||void 0===ue||ue.addEventListener("click",(function(){de.wipeToRange(window.getSelection().getRangeAt(0))}))})();
//# sourceMappingURL=refills.js.map